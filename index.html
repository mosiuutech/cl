<html lang="pl"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Lista obecnoÅ›ci</title>
    <style>
   /* === Layout === */
html,
body,
#app {
  height: 100%;
  margin: 0;
  padding: 0;
}

body {
  font-family: Arial, sans-serif;
  overflow-x: hidden;
  background: #f5f5f5;
}

#app {
  display: flex;
  height: 100%;
}

.hidden {
  display: none;
}

/* === Sidebar === */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  height: 100%;
  width: 60px;
  background-color: #333;
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 20px;
  z-index: 1001;
  box-sizing: border-box;
  justify-content: flex-start;
}

.sidebar-footer {
  margin-top: auto;
  padding: 10px 0;
  font-size: 12px;
  color: #aaa;
  user-select: none;
  text-align: center;
  width: 100%;
}

.menu-button {
  width: 40px;
  height: 40px;
  margin: 10px 0;
  background-color: #555;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  color: white;
  transition: background 0.3s;
}

.menu-button:hover,
.menu-button.active {
  background-color: #777;
}

/* === Theme toggle === */
#themeToggle {
  font-size: 24px;
  margin: 15px 0;
  background: none;
  border: none;
  cursor: pointer;
  color: white;
  transition: transform 0.3s;
}

#themeToggle:hover {
  transform: scale(1.2);
}

/* === Content === */
.content {
  flex-grow: 1;
  padding: 20px;
  overflow-y: auto;
  margin-left: 60px;
  min-height: 100%;
  box-sizing: border-box;
}

#results div {
  margin-bottom: 10px;
}

/* === Buttons === */
button {
  margin: 10px 5px 20px 0;
  padding: 8px 15px;
  cursor: pointer;
}

.styled-filter-btn {
  background-color: #eee;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.3s;
  font-weight: bold;
}

.styled-filter-btn:hover {
  background-color: #ddd;
}

.styled-filter-btn.active {
  background-color: #1a73e8;
  color: white;
}

.styled-action-btn {
  background-color: #1a73e8;
  color: white;
  border: none;
  padding: 8px 14px;
  margin: 5px 5px 10px 0;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  transition: background 0.3s;
}

.styled-action-btn:hover {
  background-color: #1669c1;
}

/* === Toast === */
#toast {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #333;
  color: white;
  padding: 10px 20px;
  border-radius: 6px;
  z-index: 1000;
  display: none;
  font-weight: bold;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
}

/* === Page Guide === */
#page-guide {
  white-space: normal;
  max-width: 600px;
  margin: 0 auto;
  line-height: 1.5;
  font-size: 16px;
  color: #333;
}

#page-guide h2 {
  border-bottom: 2px solid #1a73e8;
  padding-bottom: 8px;
  margin-bottom: 20px;
}

#page-guide section {
  margin-bottom: 25px;
}

#page-guide h3 {
  color: #1a73e8;
  margin-bottom: 10px;
}

#page-guide ol,
#page-guide ul {
  padding-left: 20px;
}

#page-guide .alert {
  background-color: #ffe5e5;
  color: #b30000;
  padding: 10px;
  border-radius: 8px;
  font-weight: bold;
  margin-top: 10px;
}

/* === Links === */
a.download-link {
  margin-left: 10px;
  text-decoration: none;
  color: #1a73e8;
  font-weight: bold;
}

a.download-link:hover {
  text-decoration: underline;
}

/* === Status Labels === */
.status {
  font-weight: bold;
  margin-left: 10px;
}

.status.existing {
  color: green;
}

.status.new {
  color: red;
}

/* === Headings === */
h2 {
  border-bottom: 1px solid #ddd;
  padding-bottom: 5px;
}

/* === Dark Mode === */
body.dark-mode {
  background-color: #121212;
  color: #eee;
}

body.dark-mode .content {
  background-color: #1e1e1e;
  color: #eee;
}

body.dark-mode .sidebar {
  background-color: #222;
}

body.dark-mode .menu-button {
  background-color: #444;
}

body.dark-mode .menu-button:hover,
body.dark-mode .menu-button.active {
  background-color: #666;
}

body.dark-mode #page-guide {
  color: #eee;
}

body.dark-mode #page-guide h2 {
  border-bottom: 2px solid #90caf9;
}

body.dark-mode #page-guide h3 {
  color: #90caf9;
}

body.dark-mode #page-guide .alert {
  background-color: #4d1c1c;
  color: #ff8a80;
}
/* === Contact role blocks === */
.contact-role {
  margin-top: 20px;
  margin-bottom: 10px;
  font-weight: bold;
  font-size: 16px;
  padding: 10px 12px;
  border-left: 6px solid;
  border-radius: 4px;
}

.role-supervisor {
  background-color: #e3f2fd;
  border-color: #2196f3;
  color: #0d47a1;
}

.role-client {
  background-color: #fce4ec;
  border-color: #e91e63;
  color: #880e4f;
}

.role-crew {
  background-color: #e8f5e9;
  border-color: #4caf50;
  color: #1b5e20;
}

/* === Dark mode overrides === */
body.dark-mode .role-supervisor {
  background-color: #0d47a1;
  border-color: #42a5f5;
  color: #e3f2fd;
}

body.dark-mode .role-client {
  background-color: #880e4f;
  border-color: #f48fb1;
  color: #fce4ec;
}

body.dark-mode .role-crew {
  background-color: #1b5e20;
  border-color: #81c784;
  color: #e8f5e9;
}
    </style>
  </head>
  <body>
    <div id="app">
      <!-- Sidebar buttons -->
      <div class="sidebar">
        <div class="menu-button active" data-page="home" title="Strona gÅ‚Ã³wna">
          ğŸ 
        </div>
        <div class="menu-button" data-page="contacts" title="Kontakty">ğŸ“‡</div>
        <div class="menu-button" data-page="guide" title="Poradnik">ğŸ“˜</div>
        <button id="themeToggle" title="PrzeÅ‚Ä…cz motyw">ğŸŒ™</button>
        <div class="sidebar-footer">created by mosiuu</div>
      </div>

      <!-- Content area -->
      <div class="content">
        <!-- HOME -->
        <div id="page-home" class="">
         <h2>Wgraj PDF z obecnoÅ›ciÄ…</h2>
<label style="display: inline-block; background: #1a73e8; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold;">
  ğŸ“„ Wybierz plik PDF
  <input type="file" id="pdfInput" accept="application/pdf" style="display: none;">
</label>

          <h2>ğŸ“‹ Wyniki:</h2>
          
  <div id="filterSection" style="margin: 15px 0; display: none;">
  <strong style="display: block; margin-bottom: 6px;">Filtruj:</strong>
  <div style="display: flex; gap: 8px; flex-wrap: wrap;">
    <button data-filter="all" class="filter-btn styled-filter-btn active">Wszyscy</button>
    <button data-filter="new" class="filter-btn styled-filter-btn">Nowi</button>
    <button data-filter="existing" class="filter-btn styled-filter-btn">Zapisani</button>
  </div>
</div>
<div id="results"></div>
</div>

        <!-- CONTACTS -->
        <div id="page-contacts" class="hidden">
          <h2>Importuj kontakty (.vcf z iPhone'a)</h2>
         <label style="display: inline-block; background: #1a73e8; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold;">
  ğŸ“‡ Wybierz plik VCF
  <input type="file" id="vcfInput" accept=".vcf" style="display: none;">
</label>

         <div style="margin-top: 15px;">
  <button id="saveContactsBtn" class="styled-action-btn">ğŸ’¾ Zapisz kontakty do pamiÄ™ci</button>
  <button id="clearContactsBtn" class="styled-action-btn" style="background: #e53935;">ğŸ—‘ WyczyÅ›Ä‡ zapisane kontakty</button>
</div>

          <div id="saveInfo">Brak zapisanych kontaktÃ³w.<div style="margin-top: 8px; font-weight: bold; color: rgb(114, 28, 36); background-color: rgb(248, 215, 218); padding: 6px; border-radius: 6px;">âš ï¸ Plik z kontaktami nie jest zaÅ‚adowany.</div></div>
        </div>

        <!-- GUIDE -->
       <div id="page-guide" class="hidden">
  <h2>ğŸ“˜ Poradnik uÅ¼ytkownika do aplikacji â€Lista obecnoÅ›ciâ€</h2>

  <section style="margin-bottom: 25px;">
    <h3>Jak zdobyÄ‡ plik z kontaktami (.vcf)?</h3>
    <ol>
      <li>WejdÅº w aplikacjÄ™ Kontakty na swoim telefonie.</li>
      <li>Przytrzymaj listÄ™ kontaktÃ³w â€Wszystkie kontaktyâ€.</li>
      <li>Pojawi siÄ™ okienko, w ktÃ³rym wybierz opcjÄ™ â€Eksportujâ€.</li>
      <li>Z dostÄ™pnych opcji wybierz tylko: imiÄ™, nazwisko oraz caÅ‚Ä… zawartoÅ›Ä‡ zakÅ‚adki â€komÃ³rkaâ€.</li>
      <li>NastÄ™pnie kliknij â€Zachowaj w plikachâ€ (lub â€Zapisz do plikÃ³wâ€).</li>
    </ol>
  </section>

  <section style="margin-bottom: 25px;">
    <h3>SkÄ…d wziÄ…Ä‡ plik z listÄ… obecnoÅ›ci (PDF)?</h3>
    <ol>
      <li>Zaloguj siÄ™ do systemu Sinch.</li>
      <li>WejdÅº w zlecenie, na ktÃ³rym jesteÅ› crewbossem.</li>
      <li>Wybierz sekcjÄ™ â€Zapisani pracownicyâ€.</li>
      <li>Kliknij â€Pobierz listÄ™â€ w formacie PDF.</li>
    </ol>
  </section>

  <section style="margin-bottom: 25px;">
    <h3>Opis aplikacji</h3>
    <p>To narzÄ™dzie pozwala Ci:</p>
    <ul>
      <li>WczytaÄ‡ listÄ™ obecnoÅ›ci z pliku PDF i wyciÄ…gnÄ…Ä‡ z niej imiona i numery telefonÃ³w,</li>
      <li>ZaimportowaÄ‡ swoje kontakty z pliku .vcf (np. z iPhoneâ€™a),</li>
      <li>PorÃ³wnaÄ‡, ktÃ³re numery z PDF sÄ… juÅ¼ w Twoich kontaktach, a ktÃ³re sÄ… nowe,</li>
      <li>PobieraÄ‡ nowe kontakty jako pliki vCard, by Å‚atwo je dodaÄ‡ do telefonu,</li>
      <li>FiltrowaÄ‡ listÄ™ wyÅ›wietlanych kontaktÃ³w wedÅ‚ug statusu (wszyscy, nowi, zapisani).</li>
    </ul>
  </section>

  <section style="margin-bottom: 25px;">
    <h3>WskazÃ³wki</h3>
    <ul>
      <li>Po zaÅ‚adowaniu pliku PDF lub VCF pojawi siÄ™ krÃ³tka informacja (â€toastâ€) o powodzeniu operacji.</li>
      <li>MoÅ¼esz filtrowaÄ‡ kontakty, aby lepiej zarzÄ…dzaÄ‡ listÄ… obecnoÅ›ci.</li>
      <li>DodajÄ…c nowy kontakt (poprzez pobranie vCard), aplikacja automatycznie zapisuje go lokalnie.</li>
      <li>Wszystkie dane sÄ… przechowywane lokalnie w przeglÄ…darce i nie sÄ… wysyÅ‚ane na serwer.</li>
    </ul>
  </section>

<section style="margin-bottom: 25px;">
  <h3>2. Jak korzystaÄ‡ z aplikacji</h3>
  <p>Struktura strony:</p>
  <p>Po lewej stronie masz menu (tzw. sidebar) z trzema przyciskami:</p>
  <ul style="padding-left: 20px;">
    <li>ğŸ  <strong>Strona gÅ‚Ã³wna</strong> â€“ do wczytywania i wyÅ›wietlania obecnoÅ›ci z PDF,</li>
    <li>ğŸ“‡ <strong>Kontakty</strong> â€“ do importu i zarzÄ…dzania kontaktami z pliku .vcf,</li>
    <li>ğŸ“˜ <strong>Poradnik</strong> â€“ opis programu i jego funkcji.</li>
  </ul>
</section>

<section style="margin-bottom: 25px;">
  <h3>3. Strona gÅ‚Ã³wna (ğŸ )</h3>
  <h4>Co tu robiÄ‡:</h4>
  <ol style="padding-left: 20px;">
    <li>Kliknij â€Wybierz plikâ€.</li>
    <li>Wybierz plik PDF zawierajÄ…cy listÄ™ osÃ³b z imionami i numerami telefonÃ³w.</li>
    <li>Aplikacja przeczyta ten plik i wyÅ›wietli listÄ™ kontaktÃ³w.</li>
  </ol>

  <h4>Wyniki</h4>
  <p>PoniÅ¼ej zobaczysz listÄ™ wyciÄ…gniÄ™tych kontaktÃ³w.</p>
  <p>Przy kaÅ¼dym kontakcie bÄ™dzie informacja, czy jest juÅ¼ w Twoich kontaktach, czy jest nowy.</p>

  <h4>Filtry kontaktÃ³w</h4>
  <p>MoÅ¼esz wybraÄ‡, ktÃ³re kontakty chcesz widzieÄ‡:</p>
  <ul style="padding-left: 20px;">
    <li><strong>Wszyscy</strong> â€“ pokaÅ¼e wszystkie kontakty z PDF,</li>
    <li><strong>Nowi</strong> â€“ tylko kontakty, ktÃ³rych jeszcze nie masz w kontaktach,</li>
    <li><strong>Zapisani</strong> â€“ kontakty, ktÃ³re juÅ¼ sÄ… w Twojej ksiÄ…Å¼ce telefonicznej.</li>
  </ul>

  <h4>Dodawanie nowego kontaktu</h4>
  <ul style="padding-left: 20px;">
    <li>Przy nowym kontakcie pojawi siÄ™ link â€ğŸ“¥ vCardâ€.</li>
    <li>Kliknij go, aby pobraÄ‡ plik z danymi kontaktowymi i Å‚atwo zaimportowaÄ‡ go do telefonu.</li>
  <div style="background-color: #ffe5e5; color: #b30000; padding: 10px; border-radius: 8px; font-weight: bold; margin-top: 10px;">
  âš ï¸ Uwaga: Po klikniÄ™ciu w â€ğŸ“¥ vCardâ€, kontakt zostaje automatycznie zapisany w pamiÄ™ci aplikacji jako â€zapisany kontaktâ€ â€“ nawet jeÅ›li faktycznie nie dodasz go do ksiÄ…Å¼ki telefonicznej.
</div>
    <li>DziÄ™ki temu przy kolejnym imporcie PDF, ten kontakt bÄ™dzie juÅ¼ rozpoznawany jako znany.</li>
  </ul>
</section>


  <section style="margin-bottom: 25px;">
  <h3>4. ZakÅ‚adka Kontakty (ğŸ“‡)</h3>
  <p>Import kontaktÃ³w z pliku .vcf:</p>
  <ol style="padding-left: 20px;">
    <li>Kliknij â€Wybierz plikâ€ i zaÅ‚aduj plik .vcf (np. z iPhoneâ€™a).</li>
    <li>Aplikacja odczyta numery telefonÃ³w z tego pliku i przygotuje listÄ™ zapisanych kontaktÃ³w.</li>
    <li>Aby zapisaÄ‡ je na staÅ‚e w przeglÄ…darce, kliknij â€ğŸ’¾ Zapisz kontakty do pamiÄ™ciâ€.</li>
    <li>JeÅ›li chcesz usunÄ…Ä‡ wszystkie zapisane kontakty z pamiÄ™ci przeglÄ…darki, kliknij â€ğŸ—‘ WyczyÅ›Ä‡ zapisane kontaktyâ€.</li>
  </ol>
  <p>Pod tymi przyciskami zobaczysz informacjÄ™ o dacie ostatniego zapisu.</p>
</section>

<section style="margin-bottom: 25px;">
  <h3>5. Jak dziaÅ‚a â€zapisywanie kontaktÃ³wâ€?</h3>
  <ul style="padding-left: 20px;">
    <li>Kontakty importowane z pliku .vcf sÄ… zapisywane lokalnie w przeglÄ…darce (nie na serwerze).</li>
    <li>DziÄ™ki temu aplikacja wie, ktÃ³re kontakty masz juÅ¼ zapisane i potrafi porÃ³wnaÄ‡ je z tymi z PDF.</li>
    <li>MoÅ¼esz usuwaÄ‡ i ponownie importowaÄ‡ kontakty wedÅ‚ug potrzeb.</li>
  </ul>
</section>

<section style="margin-bottom: 25px;">
  <h3>6. Co siÄ™ dzieje po klikniÄ™ciu â€ğŸ“¥ vCardâ€?</h3>
  <ul style="padding-left: 20px;">
    <li>Po klikniÄ™ciu, aplikacja wygeneruje plik .vcf zawierajÄ…cy dane kontaktowe tej osoby.</li>
    <li>Ten kontakt zostanie automatycznie uznany za zapisany i dodany do lokalnej bazy.</li>
    <li>Nawet jeÅ›li nie zaimportujesz go rÄ™cznie do ksiÄ…Å¼ki adresowej, aplikacja juÅ¼ go zapamiÄ™ta.</li>
  </ul>
</section>

<section style="margin-bottom: 25px;">
  <h3>7. Dodatkowe wskazÃ³wki</h3>
  <ul style="padding-left: 20px;">
    <li>Po zaÅ‚adowaniu pliku PDF lub VCF pojawi siÄ™ krÃ³tka informacja (tzw. â€toastâ€) na gÃ³rze ekranu.</li>
    <li>Przycisk menu po lewej stronie zmienia widok bez przeÅ‚adowania strony.</li>
    <li>Wszystkie dane (lista obecnoÅ›ci i kontakty) sÄ… przechowywane wyÅ‚Ä…cznie w Twojej przeglÄ…darce.</li>
    <li>Aplikacja nie wysyÅ‚a Å¼adnych danych na serwer â€“ wszystko dziaÅ‚a lokalnie i bezpiecznie.</li>
     <li>Projekt zostaÅ‚ wykonany w ciÄ…gu 2 godzin, dlatego mogÄ… wystÄ…piÄ‡ bÅ‚Ä™dy lub nieprzewidziane zachowania. Autor nie ponosi odpowiedzialnoÅ›ci za ewentualne problemy wynikajÄ…ce z uÅ¼ytkowania aplikacji.</li>
  </ul>
</section>

</div>


    <!-- Toast -->
    <div id="toast"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script>
      // Funkcja przeÅ‚Ä…czania widoku stron
      function showPage(id) {
        ["home", "contacts", "guide"].forEach((pg) => {
          document.getElementById("page-" + pg).classList.add("hidden");
        });
        document.getElementById("page-" + id).classList.remove("hidden");

        // Aktywacja przycisku w sidebarze
        document.querySelectorAll(".menu-button").forEach((btn) => {
          btn.classList.toggle("active", btn.getAttribute("data-page") === id);
        });
      }

      // NasÅ‚uchiwanie klikniÄ™Ä‡ na przyciski sidebaru
      document.querySelectorAll(".menu-button").forEach((btn) => {
        btn.addEventListener("click", () => {
          const page = btn.getAttribute("data-page");
          showPage(page);
        });
      });

      // DomyÅ›lnie pokazujemy stronÄ™ gÅ‚Ã³wnÄ…
      window.addEventListener("load", () => showPage("home"));

      const STORAGE_CONTACTS_KEY = "savedImportedNumbers";
      const STORAGE_SAVE_DATE_KEY = "saveDate";

      let importedPhoneNumbers = [];
      let parsedPDFContacts = [];
      let newContacts = [];

      const resultsDiv = document.getElementById("results");
      const saveInfoDiv = document.getElementById("saveInfo");
      const toast = document.getElementById("toast");

      window.currentFilter = "all";

      function normalize(phone) {
        return phone.replace(/\D/g, "").replace(/^48/, "").replace(/^0+/, "");
      }

      function showToast(message, isSuccess = true) {
        toast.textContent = message;
        toast.style.backgroundColor = isSuccess ? "#4CAF50" : "#F44336";
        toast.style.display = "block";
        setTimeout(() => {
          toast.style.display = "none";
        }, 1800);
      }

      async function parseVCF(file) {
        try {
          const text = await file.text();
          const phoneRegex = /TEL[^:]*:([\d\s\-\+]+)/g;
          importedPhoneNumbers = [];
          let match;
          while ((match = phoneRegex.exec(text)) !== null) {
            const clean = normalize(match[1]);
            if (clean.length >= 6) importedPhoneNumbers.push(clean);
          }
          if (importedPhoneNumbers.length === 0) {
            showToast("Nie znaleziono numerÃ³w w pliku VCF.", false);
            return;
          }
          showToast(`Zaimportowano ${importedPhoneNumbers.length} numerÃ³w z VCF.`);
displaySaveInfo();

// JeÅ›li PDF byÅ‚ juÅ¼ wczeÅ›niej zaÅ‚adowany â€” odÅ›wieÅ¼ kontakty
if (parsedPDFContacts.length > 0) {
  displayContacts();
}
          displaySaveInfo();
        } catch (err) {
          console.error(err);
          showToast("BÅ‚Ä…d podczas parsowania pliku VCF.", false);
        }
      }

      function saveContactsToStorage() {
        if (importedPhoneNumbers.length === 0) {
          showToast("Brak kontaktÃ³w do zapisania. Zaimportuj plik VCF.", false);
          return;
        }
        localStorage.setItem(
          STORAGE_CONTACTS_KEY,
          JSON.stringify(importedPhoneNumbers)
        );
        localStorage.setItem(STORAGE_SAVE_DATE_KEY, new Date().toISOString());
        showToast(`Zapisano ${importedPhoneNumbers.length} kontaktÃ³w.`);
        displaySaveInfo();
      }

      function loadContactsFromStorage() {
  const saved = localStorage.getItem(STORAGE_CONTACTS_KEY);
  if (saved) {
    importedPhoneNumbers = JSON.parse(saved);
    showToast(`ZaÅ‚adowano ${importedPhoneNumbers.length} kontaktÃ³w z pamiÄ™ci.`);
  } else {
    showToast("Brak zapisanych kontaktÃ³w w pamiÄ™ci.", false);
  }
  displaySaveInfo();
}
      function clearContactsStorage() {
        localStorage.removeItem(STORAGE_CONTACTS_KEY);
        localStorage.removeItem(STORAGE_SAVE_DATE_KEY);
        importedPhoneNumbers = [];
        parsedPDFContacts = [];
        newContacts = [];
        resultsDiv.innerHTML = "";
        saveInfoDiv.textContent = "";
        showToast("Zapisane kontakty zostaÅ‚y usuniÄ™te.");
      }

   function displaySaveInfo() {
  const dateStr = localStorage.getItem(STORAGE_SAVE_DATE_KEY);
  if (dateStr) {
    const date = new Date(dateStr);
    saveInfoDiv.textContent = `Kontakty zapisane: ${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
  } else {
    saveInfoDiv.textContent = "Nie zapisano Å¼adnych kontaktÃ³w do pamiÄ™ci urzÄ…dzenia.";
  }

  // Dodatkowa informacja o aktualnym zaÅ‚adowaniu pliku VCF
  const info = document.createElement("div");
  info.style.marginTop = "8px";
  info.style.fontWeight = "bold";
  info.style.color = importedPhoneNumbers.length > 0 ? "#155724" : "#721c24";
  info.style.backgroundColor = importedPhoneNumbers.length > 0 ? "#d4edda" : "#f8d7da";
  info.style.padding = "6px";
  info.style.borderRadius = "6px";
  info.textContent = importedPhoneNumbers.length > 0
  ? `âœ… Plik z kontaktami zostaÅ‚ zaÅ‚adowany (${importedPhoneNumbers.length} numerÃ³w).`
  : "âš ï¸ Nie zaÅ‚adowano pliku z kontaktami â€“ wybierz plik VCF.";

  saveInfoDiv.appendChild(info);
}

        async function parsePDF(file) {
  try {
    const arrayBuffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
    let fullText = "";

    for (let i = 1; i <= pdf.numPages; i++) {
      const page = await pdf.getPage(i);
      const content = await page.getTextContent();
      const text = content.items.map((item) => item.str).join(" ");
      fullText += text + "\n";
    }

    parsedPDFContacts = [];

    // === Supervisor ===
    const supMatch = fullText.match(/Opiekun\s+([A-ZÅÅšÅ¹Å»Ä†Åƒa-zÄ…Ä‡Ä™Å‚Å„Ã³Å›ÅºÅ¼ ]+)\s+\+?48[\s-]?(\d{3})[\s-]?(\d{3})[\s-]?(\d{3})/);
    if (supMatch) {
      parsedPDFContacts.push({
        name: supMatch[1].trim(),
        phone: normalize(`${supMatch[2]}${supMatch[3]}${supMatch[4]}`),
        role: "supervisor"
      });
    }

    // === Client ===
    const clientMatch = fullText.match(/Kontakt do klienta\s+([A-ZÅÅšÅ¹Å»Ä†Åƒa-zÄ…Ä‡Ä™Å‚Å„Ã³Å›ÅºÅ¼]+)\s+\+?48[\s-]?(\d{3})[\s-]?(\d{3})[\s-]?(\d{3})/);
    if (clientMatch) {
      parsedPDFContacts.push({
        name: clientMatch[1].trim(),
        phone: normalize(`${clientMatch[2]}${clientMatch[3]}${clientMatch[4]}`),
        role: "client"
      });
    }

    // === Crewboss === (pomijany)
    const crewbossMatch = fullText.match(/Stagehand - Crewboss.*?([A-ZÅÅšÅ¹Å»Ä†Åƒa-zÄ…Ä‡Ä™Å‚Å„Ã³Å›ÅºÅ¼]+ [A-ZÅÅšÅ¹Å»Ä†Åƒa-zÄ…Ä‡Ä™Å‚Å„Ã³Å›ÅºÅ¼]+)\s+\+48\s*(\d{3})\s*(\d{3})\s*(\d{3})/);
    let crewbossPhone = null;
    if (crewbossMatch) {
      crewbossPhone = normalize(`${crewbossMatch[2]}${crewbossMatch[3]}${crewbossMatch[4]}`);
    }

    // === Crew === (wszyscy czÅ‚onkowie personelu)
    const allMatches = [...fullText.matchAll(/([A-ZÅÅšÅ¹Å»Ä†Åƒa-zÄ…Ä‡Ä™Å‚Å„Ã³Å›ÅºÅ¼]+ [A-ZÅÅšÅ¹Å»Ä†Åƒa-zÄ…Ä‡Ä™Å‚Å„Ã³Å›ÅºÅ¼]+)\s*\+48\s*(\d{3})\s*(\d{3})\s*(\d{3})/g)];

    for (const match of allMatches) {
      const name = match[1].trim();
      const phone = normalize(`${match[2]}${match[3]}${match[4]}`);

      // Pomijamy supervisor, client i crewboss
      const alreadyAdded = parsedPDFContacts.some(p => p.phone === phone);
      if (!alreadyAdded && phone !== crewbossPhone) {
        parsedPDFContacts.push({
          name,
          phone,
          role: "crew"
        });
      }
    }

    if (parsedPDFContacts.length === 0) {
      resultsDiv.innerHTML = "<p>Nie znaleziono kontaktÃ³w w PDF.</p>";
      return;
    }

    displayContacts();
  } catch (e) {
    console.error(e);
    resultsDiv.innerHTML = "<p>BÅ‚Ä…d podczas przetwarzania PDF.</p>";
  } finally {
    document.getElementById("pdfInput").value = "";
  }
}

      function createVCard({ name, phone }) {
        const parts = name.split(" ");
        const firstName = parts[0] || "";
        const lastName = parts.slice(1).join(" ");
        return `BEGIN:VCARD
VERSION:3.0
FN:${name}
N:${lastName};${firstName}
TEL;TYPE=CELL:${phone}
END:VCARD`;
      }

      function generateDownloadLink(contact) {
        const vcf = createVCard(contact);
        const blob = new Blob([vcf], { type: "text/vcard" });
        const url = URL.createObjectURL(blob);
        return { url, filename: `${contact.name}.vcf` };
      }

function displayContacts() {
  const filter = window.currentFilter || "all";
  resultsDiv.innerHTML = "";

  // Pokazujemy filtry dopiero po zaÅ‚adowaniu wynikÃ³w
  document.getElementById("filterSection").style.display = "block";

  // Info o synchronizacji z kontaktami
  const syncInfo = document.createElement("div");
  syncInfo.style.padding = "10px";
  syncInfo.style.marginBottom = "15px";
  syncInfo.style.borderRadius = "6px";
  syncInfo.style.fontWeight = "bold";
  syncInfo.style.color = importedPhoneNumbers.length > 0 ? "#155724" : "#721c24";
  syncInfo.style.backgroundColor = importedPhoneNumbers.length > 0 ? "#d4edda" : "#f8d7da";
  syncInfo.textContent = importedPhoneNumbers.length > 0
    ? "âœ… Lista jest zsynchronizowana z kontaktami."
    : "âš ï¸ Lista nie jest zsynchronizowana z kontaktami.";
  resultsDiv.appendChild(syncInfo);

  newContacts = [];
  let anyVisible = false;

  const groups = {
    supervisor: [],
    client: [],
    crew: []
  };

  parsedPDFContacts.forEach(contact => {
    if (groups[contact.role]) {
      groups[contact.role].push(contact);
    }
  });

  const roleConfig = {
    supervisor: { label: "ğŸ§‘â€ğŸ’¼ Supervisor" },
    client: { label: "ğŸ§‘â€ğŸ’» Klient" },
    crew: { label: "ğŸ‘· Crew" }
  };

  ["supervisor", "client", "crew"].forEach(role => {
    const people = groups[role];

    // Tylko kontakty widoczne w ramach aktualnego filtra
    const visiblePeople = people.filter(({ phone }) => {
      const exists = importedPhoneNumbers.includes(phone);
      return (
        filter === "all" ||
        (filter === "new" && !exists) ||
        (filter === "existing" && exists)
      );
    });

    // Pomijamy caÅ‚Ä… sekcjÄ™ jeÅ›li nie ma nic do pokazania
    if (visiblePeople.length === 0) return;

    // NagÅ‚Ã³wek sekcji
    const sectionHeader = document.createElement("div");
    sectionHeader.className = `contact-role role-${role}`;
    sectionHeader.textContent = roleConfig[role].label;
    resultsDiv.appendChild(sectionHeader);

    visiblePeople.forEach(({ name, phone }) => {
      const exists = importedPhoneNumbers.includes(phone);
      if (!exists) newContacts.push({ name, phone });

      const contactDiv = document.createElement("div");
      contactDiv.style.padding = "6px 12px";
      contactDiv.style.borderBottom = "1px solid #ccc";
      contactDiv.style.display = "flex";
      contactDiv.style.justifyContent = "space-between";
      contactDiv.style.alignItems = "center";

      const nameLine = document.createElement("span");
      nameLine.textContent = name;
      nameLine.style.fontWeight = "bold";

      const rightSide = document.createElement("span");

      const statusSpan = document.createElement("span");
      statusSpan.className = "status " + (exists ? "existing" : "new");
      statusSpan.textContent = exists ? "âœ… JuÅ¼ w kontaktach" : "â• Nowy kontakt";

      rightSide.appendChild(statusSpan);

      if (!exists) {
        const link = document.createElement("a");
        link.href = "#";
        link.className = "download-link";
        link.dataset.name = name;
        link.dataset.phone = phone;
        link.textContent = "ğŸ“¥ vCard";
        link.style.marginLeft = "8px";

        link.addEventListener("click", (e) => {
          e.preventDefault();
          const contact = {
            name: link.dataset.name,
            phone: link.dataset.phone,
          };
          const { url, filename } = generateDownloadLink(contact);
          const a = document.createElement("a");
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);

          if (!importedPhoneNumbers.includes(contact.phone)) {
            importedPhoneNumbers.push(contact.phone);
            localStorage.setItem(STORAGE_CONTACTS_KEY, JSON.stringify(importedPhoneNumbers));
            localStorage.setItem(STORAGE_SAVE_DATE_KEY, new Date().toISOString());
            showToast(`Dodano ${contact.name} do zapisanych kontaktÃ³w`);
          }

          displayContacts(); // OdÅ›wieÅ¼enie widoku po zapisaniu
        });

        rightSide.appendChild(link);
      }

      contactDiv.appendChild(nameLine);
      contactDiv.appendChild(rightSide);
      resultsDiv.appendChild(contactDiv);
    });

    anyVisible = true;
  });

  if (!anyVisible) {
    const noResult = document.createElement("p");
    noResult.textContent = "Brak kontaktÃ³w do wyÅ›wietlenia dla wybranego filtra.";
    resultsDiv.appendChild(noResult);
  }
}
        

      document.getElementById("pdfInput").addEventListener("change", (e) => {
        if (e.target.files.length) parsePDF(e.target.files[0]);
      });

      document.getElementById("vcfInput").addEventListener("change", (e) => {
        if (e.target.files.length) parseVCF(e.target.files[0]);
      });

      document
        .getElementById("saveContactsBtn")
        .addEventListener("click", saveContactsToStorage);

      document
        .getElementById("clearContactsBtn")
        .addEventListener("click", clearContactsStorage);

      document.querySelectorAll(".filter-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          window.currentFilter = btn.getAttribute("data-filter");
          document
            .querySelectorAll(".filter-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          displayContacts();
        });
      });

      // Ustaw domyÅ›lny filtr "all"
      window.addEventListener("load", () => {
        window.currentFilter = "all";
        document.querySelector('[data-filter="all"]').classList.add("active");
        loadContactsFromStorage();
        
      });
      document.querySelectorAll(".filter-btn").forEach((btn) => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".filter-btn").forEach((b) =>
      b.classList.remove("active")
    );
    btn.classList.add("active");
  });
});
const themeToggle = document.getElementById('themeToggle');

// ObsÅ‚uga klikniÄ™cia
themeToggle.addEventListener('click', () => {
  document.body.classList.toggle('dark-mode');
  const isDark = document.body.classList.contains('dark-mode');
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
  themeToggle.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
});

// Przy starcie strony
window.addEventListener('DOMContentLoaded', () => {
  const savedTheme = localStorage.getItem('theme');
  const isDark = savedTheme === 'dark';
  if (isDark) document.body.classList.add('dark-mode');
  themeToggle.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
});

    </script>
  

</div></div></body></html>
